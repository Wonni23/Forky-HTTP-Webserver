http {
    client_max_body_size 100M;
    error_page 400 /home/gihokim/Forky-Webserv/www/errorpages/400.html;
    error_page 401 /home/gihokim/Forky-Webserv/www/errorpages/401.html;
    error_page 403 /home/gihokim/Forky-Webserv/www/errorpages/403.html;
    error_page 404 /home/gihokim/Forky-Webserv/www/errorpages/404.html;
    error_page 405 /home/gihokim/Forky-Webserv/www/errorpages/405.html;
    error_page 413 /home/gihokim/Forky-Webserv/www/errorpages/413.html;
    error_page 500 /home/gihokim/Forky-Webserv/www/errorpages/500.html;
    error_page 501 /home/gihokim/Forky-Webserv/www/errorpages/501.html;

    # Main Test Server (Port 8080)
    server {
        listen 8080 default_server;
        server_name localhost;
        client_max_body_size 500M;

        # Test 1: Static HTML serving with autoindex
        location / {
            root /home/gihokim/Forky-Webserv/www/html;
            index index.html;
            autoindex on;
            limit_except GET HEAD {
                deny all;
            }
        }

        # Test 2: File download - various file types
        location /data/ {
            root /home/gihokim/Forky-Webserv/www;
            autoindex on;
            limit_except GET {
                deny all;
            }
        }

        # Test 3: File upload - POST
        location /upload/ {
            root /home/gihokim/Forky-Webserv/www/data;
            limit_except POST {
                deny all;
            }
            client_max_body_size 1000M;
        }

        # Test 4: File management - PUT/DELETE
        location /files/ {
            root /home/gihokim/Forky-Webserv/www/data;
            autoindex on;
        }

        # Test 5: Redirect (EXACT match)
        location = /redirect {
            return 301 http://localhost:8080/;
        }

        # Test 6: Small body size limit (100 bytes)
        location /small/ {
            root /home/gihokim/Forky-Webserv/www/data;
            limit_except POST {
                deny all;
            }
            client_max_body_size 100;
        }

        # Test 7: PHP extension CGI
        location .php {
            root /home/gihokim/Forky-Webserv/www/cgi-bin;
            cgi_pass /usr/bin/php-cgi;
            limit_except GET POST {
                deny all;
            }
            client_max_body_size 50M;
        }

        # Test 8: Python extension CGI
        location .py {
            root /home/gihokim/Forky-Webserv/www/cgi-bin;
            cgi_pass /usr/bin/python3;
            limit_except GET POST {
                deny all;
            }
            client_max_body_size 50M;
        }

        # Test 9: Bonus - Cookie/Session testing
        location /bonus/ {
            root /home/gihokim/Forky-Webserv/www/html;
            index index.html;
            autoindex on;
        }

        # Test 10: CGI with POST body
        location /cgi-post {
            root /home/gihokim/Forky-Webserv/www/cgi-bin;
            cgi_pass /usr/bin/python3;
            limit_except POST {
                deny all;
            }
            client_max_body_size 100M;
        }

        # Test 11: Method restrictions - GET only
        location /readonly/ {
            root /home/gihokim/Forky-Webserv/www;
            autoindex on;
            limit_except GET HEAD {
                deny all;
            }
        }
    }

    # Secondary Test Server (Port 8081)
    server {
        listen 8081;
        server_name test.local;

        # Different root for virtual host testing
        location / {
            root /home/gihokim/Forky-Webserv/www;
            index index.html;
            autoindex on;
        }

        # Large file upload test
        location /bigupload {
            root /home/gihokim/Forky-Webserv/www/data;
            limit_except POST PUT {
                deny all;
            }
            client_max_body_size 2000M;
        }
    }

    # Third Test Server (Port 8082) - Minimal config
    server {
        listen 8082;
        server_name minimal.local;

        location / {
            root /home/gihokim/Forky-Webserv/www/html;
            autoindex on;
        }
    }
}
